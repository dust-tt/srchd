# Erdős Problem 304

## Metadata

- **Status:** open
- **Formalized:** Yes ([Lean](https://github.com/google-deepmind/formal-conjectures/blob/main/FormalConjectures/ErdosProblems/304.lean))
- **Tags:** number theory, unit fractions
- **Source:** [erdosproblems.com/304](https://www.erdosproblems.com/304)

## Definitions

The set of `k` for which `a / b` can be expressed as a sum of `k` distinct unit fractions.

Is it true that $$N(b) \ll \log \log b$$?

## Problem Statement

*Problem statement not available locally. See [erdosproblems.com/304](https://www.erdosproblems.com/304) for details.*

## Variants and Related Results

Let $$N(a, b)$$, denoted here by `smallestCollection a b` be the minimal k such that there
exist integers $1 < n_1 < n_2 < \dots < n_k$ with
$$\frac{a}{b} = \sum_{i=1}^k \frac{1}{n_i}$$ -/
noncomputable def smallestCollection (a b : ℕ) : ℕ := sInf (unitFractionExpressible a b)

-- in fact `(unitFractionExpressible a b).Nonempty` should always be true, but we do not prove it
-- for now
@[category API, AMS 11]
lemma smallestCollection_pos {a b : ℕ} (ha : a ≠ 0) (hb : b ≠ 0)
    (h : (unitFractionExpressible a b).Nonempty) :
    0 < smallestCollection a b := by
  suffices smallestCollection a b ≠ 0 by omega
  intro h'
  have : 0 ∈ unitFractionExpressible a b := h' ▸ Nat.sInf_mem h
  simp_all

@[category API, AMS 11]
lemma smallestCollection_left_one (b : ℕ) (hb : 1 < b) : smallestCollection 1 b = 1 := by
  have : 1 ∈ unitFractionExpressible 1 b := ⟨{b}, by simpa⟩
  have : smallestCollection 1 b ≤ 1 := Nat.sInf_le this
  have : 0 ∉ unitFractionExpressible 1 b := by simp; omega
  have : smallestCollection 1 b ≠ 0 := ne_of_mem_of_not_mem (Nat.sInf_mem ⟨_, ‹_›⟩) this
  omega

@[category API, AMS 11]
lemma eq_one_of_smallestCollection_eq_one {a b : ℕ}
    (h : smallestCollection a b = 1) : ∃ m : ℕ, 1 < m ∧ (a / b : ℚ) = (m : ℚ)⁻¹ := by
  have : 1 ∈ unitFractionExpressible a b := h ▸ Nat.sInf_mem (Nat.nonempty_of_sInf_eq_succ h)
  apply eq_inv_of_one_mem_unitFractionExpressible this

@[category API, AMS 11]
lemma dvd_of_smallestCollection_eq_one {a b : ℕ}
    (h : smallestCollection a b = 1) : a ∣ b := by
  have : 1 ∈ unitFractionExpressible a b := h ▸ Nat.sInf_mem (Nat.nonempty_of_sInf_eq_succ h)
  apply dvd_of_one_mem_unitFractionExpressible this

@[category test, AMS 11]
lemma smallestCollection_two_fifteen : smallestCollection 2 15 = 2 := by
  have h : 2 ∈ unitFractionExpressible 2 15 := by
    use {10, 30}
    norm_num [Finset.card_insert_of_notMem, Finset.card_singleton]
  have : smallestCollection 2 15 ≤ 2 := Nat.sInf_le h
  have : 0 < smallestCollection 2 15 := smallestCollection_pos (by simp) (by simp) ⟨_, h⟩
  have : smallestCollection 2 15 ≠ 1 := by
    intro h'
    have := dvd_of_smallestCollection_eq_one h'
    norm_num at this
  omega

/-- Write $$N(b) = max_{1 \leq a < b} N(a, b)$$. -/
noncomputable def smallestCollectionTo (b : ℕ) : ℕ :=
  sSup {smallestCollection a b | a ∈ Finset.Ico 1 b}

/--
In 1950, Erdős [Er50c] proved the upper bound $$N(b) \ll \log b / \log \log b$$.
[Er50c] Erdős, P., Az ${1}/{x_1} + {1}/{x_2} + \ldots + {1}/{x_n} =A/B$ egyenlet eg\'{E}sz sz\'{A}m\'{u} megold\'{A}sairól. Mat. Lapok (1950), 192-210.

In 1950, Erdős [Er50c] proved the lower bound $$\log \log b \ll N(b)$$.
[Er50c] Erdős, P., Az ${1}/{x_1} + {1}/{x_2} + \ldots + {1}/{x_n} =A/B$ egyenlet eg\'{E}sz sz\'{A}m\'{u} megold\'{A}sairól. Mat. Lapok (1950), 192-210.

In 1985 Vose [Vo85] proved the upper bound $$N(b) \ll \sqrt{\log b}$$.
[Vo85] Vose, Michael D., Egyptian fractions. Bull. London Math. Soc. (1985), 21-24.
